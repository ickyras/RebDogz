<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Booking System</title>
    <!-- Tailwind CSS for Structure -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Vue.js (Easier for single-file HTML than React) -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Supabase Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-slate-50 font-sans text-slate-900">
    <div id="app" v-cloak>
        <!-- Navigation -->
        <nav class="bg-white border-b border-slate-200 sticky top-0 z-10">
            <div class="max-w-5xl mx-auto px-4 h-16 flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <div class="bg-indigo-600 p-1.5 rounded-lg text-white">
                        <i data-lucide="calendar"></i>
                    </div>
                    <span class="font-bold text-lg tracking-tight">EventBook</span>
                </div>
                <div v-if="user" class="flex items-center gap-4">
                    <span class="text-sm font-semibold text-slate-700">{{ user.email }}</span>
                    <button @click="signOut" class="text-red-600 hover:bg-red-50 p-2 rounded-full transition-colors">
                        <i data-lucide="log-out"></i>
                    </button>
                </div>
                <button v-else @click="signIn" class="bg-indigo-600 text-white px-5 py-2 rounded-full text-sm font-bold">
                    Sign In
                </button>
            </div>
        </nav>

        <main class="max-w-5xl mx-auto px-4 py-8">
            <!-- Error Message -->
            <div v-if="error" class="mb-6 p-4 bg-red-50 border border-red-100 rounded-xl flex items-center gap-3 text-red-800">
                <i data-lucide="alert-circle"></i>
                <p class="text-sm font-medium">{{ error }}</p>
            </div>

            <!-- Loading State -->
            <div v-if="loading" class="flex flex-col items-center py-20">
                <div class="animate-spin text-indigo-600 mb-4">
                    <i data-lucide="loader-2" size="40"></i>
                </div>
                <p class="text-slate-500">Loading event details...</p>
            </div>

            <!-- Event Content -->
            <div v-else-if="activeEvent" class="space-y-8">
                <section class="bg-indigo-900 rounded-3xl text-white p-8 md:p-12 shadow-xl relative overflow-hidden">
                    <h1 class="text-4xl font-extrabold mb-4">{{ activeEvent.name }}</h1>
                    <p class="text-indigo-100 text-lg opacity-90">{{ activeEvent.description }}</p>
                    <div class="mt-6 flex items-center gap-2 text-indigo-200">
                        <i data-lucide="calendar" size="18"></i>
                        <span>{{ formatDate(activeEvent.date) }}</span>
                    </div>
                </section>

                <!-- Booking Grid -->
                <section>
                    <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                        <i data-lucide="clock" class="text-indigo-600"></i>
                        Available Time Slots
                    </h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div v-for="slot in slots" :key="slot.id" 
                             @click="bookSlot(slot)"
                             :class="[
                                'p-5 rounded-2xl border transition-all cursor-pointer',
                                slot.user_id ? 'bg-slate-100 opacity-60 cursor-not-allowed' : 'bg-white hover:border-indigo-400 hover:shadow-lg'
                             ]">
                            <div class="font-mono font-bold mb-4">{{ slot.start_time.slice(0,5) }} - {{ slot.end_time.slice(0,5) }}</div>
                            <div class="flex items-center gap-2">
                                <div :class="['w-2 h-2 rounded-full', slot.user_id ? 'bg-slate-400' : 'bg-green-500']"></div>
                                <span class="text-xs font-bold text-slate-500 uppercase">{{ slot.user_id ? 'Taken' : 'Available' }}</span>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        const { createApp, ref, onMounted } = Vue;
        
        // --- REPLACE WITH YOUR CREDENTIALS ---
        const SUPABASE_URL = "https://pkfrmugpppbqetekagyh.supabase.co";
        const SUPABASE_KEY = "sb_publishable_kIDCRuBpvOWGgy54L685HQ_zuFa-PLM";
        const supabase = exports.createClient(SUPABASE_URL, SUPABASE_KEY);

        createApp({
            setup() {
                const user = ref(null);
                const activeEvent = ref(null);
                const slots = ref([]);
                const loading = ref(true);
                const error = ref(null);

                const fetchData = async () => {
                    loading.value = true;
                    try {
                        const { data: event } = await supabase.from('events').select('*').eq('is_active', true).single();
                        activeEvent.value = event;
                        if (event) {
                            const { data: slotData } = await supabase.from('time_slots').select('*').eq('event_id', event.id).order('start_time');
                            slots.value = slotData;
                        }
                    } catch (e) { error.value = "Failed to load data"; }
                    loading.value = false;
                    setTimeout(() => lucide.createIcons(), 100);
                };

                onMounted(() => {
                    fetchData();
                    lucide.createIcons();
                });

                return { user, activeEvent, slots, loading, error, formatDate: (d) => new Date(d).toLocaleDateString() };
            }
        }).mount('#app');
    </script>

    <style>
        [v-cloak] { display: none; }
    </style>
</body>
</html>